/**
* @module promise
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript ES6 promise polyfill.
* @see https://nuintun.github.io/promise
*/
!function(){"use strict";function t(t){return"function"==typeof t&&a.test(t)}function n(t,n){this.task=t,this.args=n}function e(){var t=w;w=[];for(var n=0,e=t.length;n<e;n++)t[n].run()}function r(t){return"function"==typeof t}function i(){this.callbacks=[],this.errbacks=[],this.status="pending",this.value=null,this.chained=!1}function o(t){if(!(this instanceof o))throw new TypeError(this+"is not a promise");if(!r(t))throw new TypeError("Promise resolver "+t+" is not a function");var n=new i;this._resolver=n;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(e){n.reject(e)}}function s(t,n,e,r){return function(i){var o;try{o=r(i)}catch(s){return e(s)}if(o===t)return e(new TypeError("Cannot resolve a promise with itself"));n(o)}}if(!window.Promise){var a=Function.prototype.toString.call(Function);a=(a=a.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),a=new RegExp("^"+a+"$");var u=window.MutationObserver||window.WebKitMutationObserver,c={support:function(){return t(u)},install:function(t){var n=0,e=new u(t),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=n=++n%2}}},l=window.VBArray,f=window.MessageChannel,h={support:function(){return!t(l)&&t(f)},install:function(t){var n=new f;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}},p={support:function(){return"onreadystatechange"in document.createElement("script")},install:function(t){return function(){var n=document.createElement("script");n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},document.documentElement.appendChild(n)}}},d={support:function(){return!0},install:function(t){return function(){setTimeout(t,0)}}};n.prototype.run=function(){var t=this.task,n=this.args;switch(n.length){case 0:return t();case 1:return t(n[0]);case 2:return t(n[0],n[1]);case 3:return t(n[0],n[1],n[2]);default:return t.apply(null,n)}};for(var v,w=[],y=Array.prototype.slice,g=[c,h,p,d],m=0,b=g.length;m<b;m++)if((v=g[m]).support()){v=v.install(e);break}var k=Object.prototype.toString,j=r(Array.isArray)?Array.isArray:function(t){return"[object Array]"===k.call(t)},E=window.console,A=E&&E.error?E.error:function(){};i.prototype={fulfilled:function(t){"pending"===this.status&&(this.value=t,this.status="fulfilled"),"fulfilled"===this.status&&(this.notify(this.callbacks,this.value),this.callbacks=[],this.errbacks=null)},rejected:function(t){"pending"===this.status&&(this.value=t,this.status="rejected"),"rejected"===this.status&&(this.notify(this.errbacks,this.value),this.callbacks=null,this.errbacks=[])},resolve:function(t){var n=this;if("pending"===n.status){if(!t||"object"!=typeof t&&!r(t))return n.fulfilled(t);var e=!1;try{var i=t.then;r(i)?i.call(t,function(t){e||(e=!0,n.resolve(t))},function(t){e||(e=!0,n.reject(t))}):n.fulfilled(t)}catch(o){e||n.rejected(o)}}},reject:function(t){"pending"===this.status&&this.rejected(t)},addCallbacks:function(t,n){var e=!1,r=this.callbacks,i=this.errbacks;if(r&&(e=!0,r.push(t)),i&&(e=!0,i.push(n)),e)switch(this.chained=e,this.status){case"fulfilled":this.fulfilled(this.value);break;case"rejected":this.rejected(this.value)}},notify:function(t,e){!function(t){var e=y.call(arguments,1);w.push(new n(t,e)),v()}(function(n){if(t.length)for(var r=0,i=t.length;r<i;++r)t[r](e);n.chained||"rejected"!==n.status||n.uncaught()},this)},uncaught:function(){var t=this.value;t instanceof Error?A("Uncaught",t.stack||t.name+": "+t.message):A("Uncaught Error:",t)}},o.name="Promise",o.prototype={constructor:o,then:function(t,n){var e,i,a=this._resolver,u=new o(function(t,n){e=t,i=n});return a.addCallbacks(r(t)?s(u,e,i,t):e,r(n)?s(u,e,i,n):i),u},"catch":function(t){return this.then(void 0,t)}},o.resolve=function(t){return t&&t instanceof o?t:new o(function(n){n(t)})},o.reject=function(t){return new o(function(n,e){e(t)})},o.all=function(t){return new o(function(n,e){function r(t){return function(e){s[t]=e,--u||n(s)}}if(!j(t))return e(new TypeError("Promise.all expects an array of values or promises"));var i=0,s=[],a=t.length,u=t.length;if(a<1)return n(s);for(;i<a;i++)o.resolve(t[i]).then(r(i),e)})},o.race=function(t){return new o(function(n,e){if(!j(t))return e(new TypeError("Promise.race expects an array of values or promises"));for(var r=0,i=t.length;r<i;r++)o.resolve(t[r]).then(n,e)})},window.Promise=o}}();
//# sourceMappingURL=promise.js.map
