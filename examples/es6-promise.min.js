/**
* @module promise
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript ES6 promise polyfill.
* @see https://nuintun.github.io/promise
*/
!function(){"use strict";function t(t){return"function"==typeof t&&c.test(t)}function n(t,n){this.task=t,this.args=n}function e(){var t=v;v=[];for(var n=0,e=t.length;n<e;n++)t[n].run()}function r(t){return"function"==typeof t}function i(){this._callbacks=[],this._errbacks=[],this._status="pending",this._value=null,this._chained=!1}function s(t){if(!(this instanceof s))throw new TypeError(this+"is not a promise");if(!r(t))throw new TypeError("Promise resolver "+t+" is not a function");var n=new i;this._resolver=n;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(e){n.reject(e)}}function a(t,n,e,r){return function(i){var s;try{s=r(i)}catch(a){return e(a)}if(s===t)return e(new TypeError("Cannot resolve a promise with itself"));n(s)}}if(!window.Promise){var c=Function.prototype.toString.call(Function);c=(c=c.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),c=new RegExp("^"+c+"$");var o=window.MutationObserver||window.WebKitMutationObserver,u={support:function(){return t(o)},install:function(t){var n=0,e=new o(t),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=n=++n%2}}},l=window.VBArray,f=window.MessageChannel,h={support:function(){return!t(l)&&t(f)},install:function(t){var n=new f;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}},p={support:function(){return!0},install:function(t){var n=new Image;return n.onerror=t,function(){n.src=""}}};n.prototype.run=function(){var t=this.task,n=this.args;switch(n.length){case 0:return t();case 1:return t(n[0]);case 2:return t(n[0],n[1]);case 3:return t(n[0],n[1],n[2]);default:return t.apply(null,n)}};for(var _,v=[],w=Array.prototype.slice,d=[u,h,p],g=0,y=d.length;g<y;g++)if((_=d[g]).support()){_=_.install(e);break}var b=Object.prototype.toString,k=r(Array.isArray)?Array.isArray:function(t){return"[object Array]"===b.call(t)},j=window.console,m=j&&j.error?j.error:function(){};i.prototype={fulfill:function(t){var n=this._status;"pending"!==n&&"accepted"!==n||(this._value=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._value),this._callbacks=[],this._errbacks=null)},reject:function(t){var n=this._status;"pending"!==n&&"accepted"!==n||(this._value=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._value),this._callbacks=null,this._errbacks=[])},resolve:function(t){"pending"===this._status&&(this._status="accepted",this._value=t,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(t){var n=this,e=!1;if(!t||"object"!=typeof t&&!r(t))return n.fulfill(t);try{var i=t.then;r(i)?i.call(t,function(t){e||(e=!0,n._unwrap(t))},function(t){e||(e=!0,n.reject(t))}):n.fulfill(t)}catch(s){e||n.reject(s)}},_addCallbacks:function(t,n){var e=this._callbacks,r=this._errbacks;switch(e&&e.push(t),r&&r.push(n),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._value);break;case"rejected":this.reject(this._value)}},_notify:function(t,e){!function(t){var e=w.call(arguments,1);v.push(new n(t,e)),_()}(function(n){if(t.length)for(var r=0,i=t.length;r<i;++r)t[r](e);n._chained||"rejected"!==n._status||n._uncaught()},this)},_uncaught:function(){var t=this._value;t instanceof Error?m("Uncaught",t.stack||t.name+": "+t.message):m("Uncaught Error:",t)}},s.prototype={then:function(t,n){var e,i,c=this._resolver;c._chained=!0;var o=new s(function(t,n){e=t,i=n});return c._addCallbacks(r(t)?a(o,e,i,t):e,r(n)?a(o,e,i,n):i),o},"catch":function(t){return this.then(undefined,t)}},s.resolve=function(t){return t&&t instanceof s?t:new s(function(n){n(t)})},s.reject=function(t){return new s(function(n,e){e(t)})},s.all=function(t){return new s(function(n,e){function r(t){return function(e){a[t]=e,--o||n(a)}}if(!k(t))return e(new TypeError("Promise.all expects an array of values or promises"));var i=0,a=[],c=t.length,o=t.length;if(c<1)return n(a);for(;i<c;i++)s.resolve(t[i]).then(r(i),e)})},s.race=function(t){return new s(function(n,e){if(!k(t))return e(new TypeError("Promise.race expects an array of values or promises"));for(var r=0,i=t.length;r<i;r++)s.resolve(t[r]).then(n,e)})},window.Promise=s}}();
//# sourceMappingURL=promise.js.map
